<!DOCTYPE html>
<html>
<head>
	<title>InvaderZone</title>
</head>
<body>
	<style type="text/css">
	*{
		margin: 0px;
		padding: 0px;
		position: fixed;
	}
	#starfield{
		background-image: url("img/Starfield.png");
		width: 900px;
		height: 750px;
	}
	#footer{
		background-color: gray;
		color: white;
		width: 900px;
		height: 83px;
		position: absolute;
		top: 750px;
	}
	#hud{
		width: 900px;
		height: 750px;
	}
	#scoreDisplay{
		width: 200px;
		height: 75px;
		color: cyan;
		background-color: transparent;
		position: absolute;
		top: 4px;
		right: 4px;
		text-align: right;
		font-size: 62px;
	}
	#centerMessage{
		visibility: hidden;
		width: 300px;
		height: 80px;
		color: lightblue;
		background-color: transparent;
		position: absolute;
		top: 35%;
		left: 300px;
		text-align: center;
		font-size: 62px;
	}
	#livesDisplay{
		width: 375px;
		height: 75px;
		background-color: transparent;
		position: absolute;
		top: 4px;
		left: 4px;
		display: flex;
		justify-content: space-evenly;
		justify-content: left;
	}
	.playerOne{
		background-image: url("img/Player_One.png");
		width: 70px;
		height: 75px;
		position: absolute;
	}
	.shield{
		background-image: url("img/playerOneShield.png");
		width: 70px;
		height: 85px;
		position: absolute;
	}
	.enemy1{
		background-image: url("img/Alien Starfighter.png");
		width: 70px;
		height: 75px;
		position: absolute;
	}
	.enemy2{
		background-image: url("img/sphereShip.png");
		width: 120px;
		height: 120px;
		position: absolute;
	}
	.enemy3{
		background-image: url("img/Alien Starfighter.png");
		width: 70px;
		height: 75px;
		position: absolute;
	}
	.missile{
		background-image: url("img/fireblast.png");
		width: 8px;
		height: 12px;
		position: absolute;
	}
	.energyBall{
		background-image: url("img/Energy Ball.png");
		width: 25px;
		height: 25px;
		position: absolute;
	}
	.life{
		background-image: url("img/Player_One.png");
		width: 70px;
		height: 75px;
	}
	.redBox{
		background-image: url("img/Red Upgrade.png");
		width: 50px;
		height: 50px;
		position: absolute;
	}
	.blueBox{
		background-image: url("img/Blue Upgrade.png");
		width: 50px;
		height: 50px;
		position: absolute;
	}
	.purpleBox{
		background-image: url("img/Purple Upgrade.png");
		width: 50px;
		height: 50px;
		position: absolute;
	}

	</style>

	<div id="starfield">
		<div id="enemies"></div>
		<div id="missiles"></div>
		<div id="energyballs"></div>
		<div id="boxes"></div>
		<div id="hud">
			<div id="centerMessage"></div>
		</div>
		<div id="footer">
			<div id="scoreDisplay">0</div>
			<div id="livesDisplay">
				<div class="life"></div>
				<div class="life"></div>
				<div class="life"></div>
			</div>
		</div>
		<div id="players"></div>

	</div>
	

	


	<script type="text/javascript">

// Variables

	var gameOn = true;

	var delta = 0;

	var gameSpeed = 1;

	var weaponCharged = true;

	var playerOne = {
		left: 400,
		top: 620,
		velocity: {x: 0, y: 0},
		score: 0,
		life: 3,
		attack: 1,
		shield: false
	};

	var enemies = [];

	var wave = [];

	var missiles = [];

	var energyBalls = [];

	var boxes = [];

// Functions	

	function drawPlayer(){
		if(playerOne.shield){
			var playerContent = "<div class='shield' style='left:"+playerOne.left+"px; top:"+playerOne.top+"px; '></div>";
		}
		else{
			var playerContent = "<div class='playerOne' style='left:"+playerOne.left+"px; top:"+playerOne.top+"px; '></div>";
		}
		
			document.getElementById("players").innerHTML = playerContent;
	}	

	function drawEnemies(){
		var enemyContent = "";

		for(var eid=0; eid<enemies.length; eid++){
			enemyContent += "<div class='"+enemies[eid].type+"' style='left:"+enemies[eid].position.left+"px; top:"+enemies[eid].position.top+"px; transform: rotate("+(enemies[eid].angle*57)+"deg);'></div>";
		}
		document.getElementById("enemies").innerHTML = enemyContent;
	}

	function newWave(){
		if(gameOn){
			wave = [
				{left: 150, top: -75, active: 1, type: "enemy3", life: 1, velocity: {x: 0, y: 1}, angle: 0},
				{left: 250, top: -125, active: 1, type: "enemy3", life: 1, velocity: {x: 0, y: 1}, angle: 0},
				{left: 350, top: -75, active: 1, type: "enemy3", life: 1, velocity: {x: 0, y: 1}, angle: 0},
				{left: 450, top: -125, active: 1, type: "enemy3", life: 1, velocity: {x: 0, y: 1}, angle: 0},
				{left: 550, top: -75, active: 1, type: "enemy3", life: 1, velocity: {x: 0, y: 1}, angle: 0},
				{left: 650, top: -125, active: 1, type: "enemy3", life: 1, velocity: {x: 0, y: 1}, angle: 0}
			];
			for(var idx=0; idx<wave.length; idx++){
				enemies.push(wave[idx]);
			}
			drawEnemies();
			if(gameOn){
				setTimeout(newWave, (gameSpeed*10000)); // Send a new wave of enemies in (10*gameSpeed) seconds
			}
		}
	}

	function spawnSphere(leftPos, topPos){
		enemies.push({position: {left: leftPos, top: topPos}, 
						active: 1, 
						type: "enemy2", 
						life: 5, 
						velocity: {x: 0, y: 0}, 
						angle: 0, 
						seqPointer: 0}
					);
		if(gameOn){
			setTimeout(spawnSphere, 18000, -120, 200);
		}
	}

	function spawnStarfighter(pointA, pointB){
		var deltaX = pointB.left - pointA.left;
		var deltaY = pointA.top - pointB.top;
		var angleStart = Math.atan2(deltaY, deltaX);
		var velocityX = 10*Math.cos(angleStart);
		var velocityY = -10*Math.sin(angleStart);
		enemies.push({position: {left: pointA.left, 
									top: pointA.top}, 
									pointA: {left: pointA.left, 
									top: pointA.top}, 
									pointB: {left: pointB.left, top: pointB.top}, 
									active: 1, 
									type: "enemy1", 
									life: 2, 
									velocity: {x: velocityX, y: velocityY}, 
									angle: (-angleStart)-90, 
									seqPointer: 0}
					);
	}

	function arrivals(enemyType){
		for (var eid = 0; eid<enemies.length; eid++){
			if(enemies[eid].type == enemyType && enemies[eid].active == 1){
				if(Math.abs(enemies[eid].pointB.left-enemies[eid].position.left) <= 5 && Math.abs(enemies[eid].pointB.top-enemies[eid].position.top) <= 5){
					enemies[eid].velocity.x = 0;
					enemies[eid].velocity.y = 0;
					var deltaX = playerOne.left- enemies[eid].position.left;
					var deltaY = playerOne.top - enemies[eid].position.top;
					var angleNew = Math.atan2(deltaY, deltaX);
					enemies[eid].angle = angleNew - 90;
				}
			}
		}
	}

	function sphereSequence(){
		for(var eid=0; eid<enemies.length; eid++){
			if(enemies[eid].type == "enemy2" && enemies[eid].active == 1){
				var deltaX = playerOne.left - enemies[eid].position.left;
				var deltaY = playerOne.top - enemies[eid].position.top;
				var speedX = 5*(deltaX/deltaY);

				if(enemies[eid].seqPointer < 50){
					enemies[eid].velocity.x = 6.5;
					enemies[eid].velocity.y = -3;
				}
				else if(enemies[eid].seqPointer < 200){
					enemies[eid].velocity.x = 0;
					enemies[eid].velocity.y = 0;
				}
				else if(enemies[eid].seqPointer < 255){
					enemies[eid].velocity.x = 7;
				}
				else if(enemies[eid].seqPointer < 405){
					enemies[eid].velocity.x = 0;
					enemies[eid].velocity.y = 0;
				}
				else if(enemies[eid].seqPointer < 455){
					enemies[eid].velocity.x = 6.5;
					enemies[eid].velocity.y = 3;
				}
				else if(enemies[eid].seqPointer >= 455){
					enemies[eid].active = 0;
				}
				if(enemies[eid].seqPointer == 75 || enemies[eid].seqPointer == 90 || enemies[eid].seqPointer == 105 || enemies[eid].seqPointer == 160 || enemies[eid].seqPointer == 175 || enemies[eid].seqPointer == 190){
					energyBalls.push({left: (enemies[eid].position.left+48), 
										top: (enemies[eid].position.top+48), 
										active: 1, 
										velocity: {x: speedX, y: 5}}
									);
				}
				if(enemies[eid].seqPointer == 280 || enemies[eid].seqPointer == 295 || enemies[eid].seqPointer == 310 || enemies[eid].seqPointer == 365 || enemies[eid].seqPointer == 380 || enemies[eid].seqPointer == 395){
					energyBalls.push({left: (enemies[eid].position.left+48), 
										top: (enemies[eid].position.top+48), 
										active: 1, 
										velocity: {x: speedX, y: 5}}
									);
				}
				enemies[eid].seqPointer++;
			}
		}
	}

	function movePlayer(){
		if((playerOne.left+playerOne.velocity.x+70) < 890 && (playerOne.left+playerOne.velocity.x) > 10){
			playerOne.left += playerOne.velocity.x;
		}
		else{
			playerOne.velocity.x = 0;
		}
		if((playerOne.top+playerOne.velocity.y+75) < 740 && (playerOne.top+playerOne.velocity.y) > 10){
			playerOne.top += playerOne.velocity.y;
		}
		else{
			playerOne.velocity.y = 0;
		}
	}

	function moveEnemies(){
		sphereSequence();
		arrivals("enemy1");
		var sineEvasion = Math.sin(Math.PI*(delta/90));
		for(var eid=0; eid<enemies.length; eid++){
			if(enemies[eid].type == "enemy3"){		
				enemies[eid].velocity.x = sineEvasion*1.15;
			}
			enemies[eid].position.top += enemies[eid].velocity.y;
			enemies[eid].position.left += enemies[eid].velocity.x;
		}
	}
	
	function blasterFire(){
		if(playerOne.attack < 3){ // Level one attack
				missiles.push({left: (playerOne.left+31), top: (playerOne.top-12), velocity: {x: 0, y: -8}, active: 1});
			}
			else if(playerOne.attack < 6){ // Level two attack
				missiles.push({left: (playerOne.left+15), top: (playerOne.top+35), velocity: {x: 0, y: -8}, active: 1});
				missiles.push({left: (playerOne.left+47), top: (playerOne.top+35), velocity: {x: 0, y: -8}, active: 1});
			}
			else if(playerOne.attack < 9){ // Level three attack
				missiles.push({left: (playerOne.left+31), top: (playerOne.top-12), velocity: {x: 0, y: -8}, active: 1});
				missiles.push({left: (playerOne.left+15), top: (playerOne.top+35), velocity: {x: -5, y: -7}, active: 1});
				missiles.push({left: (playerOne.left+47), top: (playerOne.top+35), velocity: {x: 5, y: -7}, active: 1});
			}
			else if(playerOne.attack < 12){ // Level four attack
				missiles.push({left: (playerOne.left+15), top: (playerOne.top+35), velocity: {x: 0, y: -8}, active: 1});
				missiles.push({left: (playerOne.left+47), top: (playerOne.top+35), velocity: {x: 0, y: -8}, active: 1});
				missiles.push({left: (playerOne.left+15), top: (playerOne.top+35), velocity: {x: -5, y: -7}, active: 1});
				missiles.push({left: (playerOne.left+47), top: (playerOne.top+35), velocity: {x: 5, y: -7}, active: 1});
			}
			else if(playerOne.attack >= 12){ // Level five attack
				missiles.push({left: (playerOne.left+15), top: (playerOne.top+35), velocity: {x: 0, y: -8}, active: 1});
				missiles.push({left: (playerOne.left+47), top: (playerOne.top+35), velocity: {x: 0, y: -8}, active: 1});
				missiles.push({left: (playerOne.left+20), top: (playerOne.top+25), velocity: {x: -5, y: -7}, active: 1});
				missiles.push({left: (playerOne.left+42), top: (playerOne.top+25), velocity: {x: 5, y: -7}, active: 1});
				missiles.push({left: (playerOne.left+5), top: (playerOne.top+50), velocity: {x: -5, y: -7}, active: 1});
				missiles.push({left: (playerOne.left+56), top: (playerOne.top+50), velocity: {x: 5, y: -7}, active: 1});
			}
			if(playerOne.score>0){
				playerOne.score--;
			}
			weaponCharged = false;
			setTimeout(blasterRecharge, 125);
	}

	function moveMissiles(){
		for(var mid=0; mid<missiles.length; mid++){
			missiles[mid].left += missiles[mid].velocity.x;
			missiles[mid].top += missiles[mid].velocity.y;
		}
	}

	function returnFire(){ // 20% chance an enemy attack succeeds, with 1 second delay
		for(var eid=0; eid<enemies.length; eid++){
			var deltaX = playerOne.left - enemies[eid].position.left;
			var deltaY = playerOne.top - enemies[eid].position.top;
			var angle = Math.atan2(deltaY, deltaX);
			var speedX = 5*Math.cos(angle);
			var speedY = 5*Math.sin(angle);
			
			if(enemies[eid].type == "enemy3"){
				if(Math.random()<=0.20){
					energyBalls.push({left: (enemies[eid].position.left+22), 
										top: (enemies[eid].position.top+52), 
										active: 1, 
										velocity : {x: speedX, y: speedY}}
									);
				}
			}
		}
		setTimeout(returnFire, 2000)
	}

	function drawProjectiles(){
		var projectileContent = "";
		for(var idx=0; idx<missiles.length; idx++){
			projectileContent += '<div class="missile" style="left:'+missiles[idx].left+'px; top:'+missiles[idx].top+'px; transform: rotate('+missiles[idx].angle+'deg)"></div>';
		}
		document.getElementById('missiles').innerHTML = projectileContent;
		projectileContent = "";
		for(var idx=0; idx<energyBalls.length; idx++){
			projectileContent += '<div class="energyBall" style="left:'+energyBalls[idx].left+'px; top:'+energyBalls[idx].top+'px"></div>';
		}
		document.getElementById('energyballs').innerHTML = projectileContent;
	}

	function moveEnergyBalls(){
		for(var eid=0; eid<energyBalls.length; eid++){
			energyBalls[eid].top += energyBalls[eid].velocity.y;
			energyBalls[eid].left += energyBalls[eid].velocity.x;
		}
	}

	function drawBoxes(){
		var boxContent = "";

		for(var idx=0; idx<boxes.length; idx++){
			if(boxes[idx].type == 1){
				boxContent += "<div class='redBox' style='left:"+boxes[idx].left+"px; top:"+boxes[idx].top+"px;'></div>";
			}
			else if(boxes[idx].type == 2){
				boxContent += "<div class='blueBox' style='left:"+boxes[idx].left+"px; top:"+boxes[idx].top+"px;'></div>";
			}
			else if(boxes[idx].type == 3){
				boxContent += "<div class='purpleBox' style='left:"+boxes[idx].left+"px; top:"+boxes[idx].top+"px;'></div>";
			}
		}
		document.getElementById("boxes").innerHTML = boxContent;
	}

	function moveBoxes(){
		for(var idx=0; idx<boxes.length; idx++){
			boxes[idx].top += 5*gameSpeed;
		}
	}

	function boxDrop(left,top){
		var chance = Math.floor(Math.random()*100);
		if(chance < 1){ // Drop extra life
			boxes.push({left: (left+31), top: (top-12), type: 3, active: 1});
		}
		else if(chance >= 1 && chance < 4){ // Drop shield
			boxes.push({left: (left+31), top: (top-12), type: 2, active: 1});
		}
		else if(chance >=4 && chance < 10){ // Drop weapon upgrade
			boxes.push({left: (left+31), top: (top-12), type: 1, active: 1});
		}

	}

	function clearInactive(){
		for(var eid=0; eid<enemies.length; eid++){ // Inactive enemies
			if(enemies[eid].active == 0){
				enemies.splice(eid,1);
			}
		}
		for(var mid=0; mid<missiles.length; mid++){ // Inactive missiles
			if(missiles[mid].active == 0){
				missiles.splice(mid,1);
			}
		}
		for(var eid=0; eid<energyBalls.length; eid++){ // Inactive energy balls
			if(energyBalls[eid].active == 0){
				energyBalls.splice(eid,1);
			}
		}
		for(var bid=0; bid<boxes.length; bid++){ // Inactive boxes
			if(boxes[bid].active == 0){
				boxes.splice(bid,1);
			}
		}
		for(var eid=0; eid<enemies.length; eid++){
			if(enemies[eid].top > 750){ // Enemies leaving starfield
				enemies.splice(eid,1);
			}
		}
		for(var eid=0; eid<energyBalls.length; eid++){ // Energyballs leaving starfield
			if(energyBalls[eid].top > 750){
				energyBalls.splice(eid,1);
			}
		}
		for(var bid=0; bid<boxes.length; bid++){ // Boxes leaving starfield
			if(boxes[bid].top > 750){
				boxes.splice(bid,1);
			}
		}
		for(var mid=0; mid<missiles.length; mid++){
			if(missiles[mid].top < -12 || missiles[mid].left < -12 || missiles[mid].left > 900){ // Missiles leaving starfield
				missiles.splice(mid,1);
			}
		}
	}

	function eventCheck(){
		for(var eid=0; eid<enemies.length; eid++){ // Check each enemy for collisions
			for(var mid=0; mid<missiles.length; mid++){ // Check for collision with missile
				if(missiles[mid].left >= (enemies[eid].position.left+3) && missiles[mid].left <= (enemies[eid].position.left+67)){
					if((missiles[mid].top+12) >= (enemies[eid].position.top+3) && missiles[mid].top <= (enemies[eid].position.top+72)){
						enemies[eid].life--;
						missiles[mid].active = 0;
						if(enemies[eid].life == 0){
							enemies[eid].active = 0;
							playerOne.score += 10;
							boxDrop(enemies[eid].position.left, enemies[eid].position.top);
						}
					}
				}
			}
			if((playerOne.left+31) >= (enemies[eid].position.left) && (playerOne.left+31) <= (enemies[eid].position.left+70)){ 
				if((playerOne.top+70) >= (enemies[eid].position.top+5) && playerOne.top <= (enemies[eid].position.top+55)){ // Player collides with enemy ship
					enemies[eid].active = 0;
					if(!playerOne.shield){
						playerOne.life--;
						enemies[eid].life--;
						playerOne.attack -= 3;
						if(playerOne.attack< 1){
							playerOne.attack = 1;
						}
						playerOne.left = 400;
						playerOne.top = 620;
						if(enemies[eid].life == 0){
							enemies[eid].active = 0;
							playerOne.score += 10;
							boxDrop(enemies[eid].position.left, enemies[eid].position.top);
						}
					}
					drawPlayer();
					drawEnemies();
					clearInactive();
				}
			}
		}
		for(var eid=0; eid<energyBalls.length; eid++){
			if((playerOne.left+55) >= energyBalls[eid].left && (playerOne.left+15) <= (energyBalls[eid].left+25)){ 
				if((playerOne.top+65) >= energyBalls[eid].top && (playerOne.top+35) <= (energyBalls[eid].top+25)){ // Player collides with energy ball
					energyBalls[eid].active = 0;
					if(!playerOne.shield){
						playerOne.life--;
						playerOne.attack -= 3;
						if(playerOne.attack < 1){
							playerOne.attack = 1;
						}
						playerOne.left = 400;
						playerOne.top = 620;
					}
					drawPlayer();
					drawEnemies();
					clearInactive();
					updateHud();
				}
			}
		}
		for(var bid=0; bid<boxes.length; bid++){
			if((playerOne.left+55) >= boxes[bid].left && (playerOne.left+15) <= (boxes[bid].left+50)){ 
				if((playerOne.top+65) >= boxes[bid].top && (playerOne.top+35) <= (boxes[bid].top+50)){ // Player collides with box
					boxes[bid].active = 0;
					if(boxes[bid].type == 1){ // Upgrade weapons level or give points for max weapons
						if(playerOne.attack < 12){
							playerOne.attack++;
						}
						else{
							playerOne.score+=50;
						}
					}
					else if(boxes[bid].type == 2){ // Activate shield
						if(playerOne.shield){
							playerOne.score+=50;
						}
						else{
							playerOne.shield = true;
							setTimeout(shieldEnd, 10000);
						}
					}
					else if(boxes[bid].type == 3){ // Regain one life
						if(playerOne.life < 5){
							playerOne.life++;
						}
						else{
							playerOne.score += 50;
						}
						
					}
					drawPlayer();
					drawBoxes();
					clearInactive();
					updateHud();
				}
			}
		}
		
		// Increase speed of game every 500 points
		if(gameSpeed > 0.35){
			gameSpeed = Math.pow(0.85, Math.floor(playerOne.score/500));
		}
		else{
			gameSpeed = 0.35;
		}

		if(playerOne.life<=0){
			gameOver();
		}

	}

	function shieldEnd(){
		playerOne.shield=false;
	}

	function blasterRecharge(){
		weaponCharged = true;
	}

	function updateHud(){
		var hudContent = "";
		for(var idx=1; idx<=playerOne.life; idx++){
			hudContent += "<div class='life'></div>";
		}
		document.getElementById("livesDisplay").innerHTML = hudContent;
		//console.log(hudContent);
		document.getElementById("scoreDisplay").innerHTML = '<div id="scoreDisplay">'+playerOne.score+'</div>';
	}

	function gameOver(){
		gameOn = false;
		document.getElementById("centerMessage").innerHTML = "Game Over";
		document.getElementById("centerMessage").style.visibility = "visible";
		playerOne.left = -99;
		playerOne.top == -99;
		drawPlayer();
		drawEnemies();
		drawProjectiles();
		clearInactive();
	}

	function choreography(){
		
	}

	function gameLoop(){
		movePlayer();
		drawPlayer();

		moveEnemies();
		drawEnemies();

		moveMissiles();
		moveEnergyBalls();
		drawProjectiles();

		moveBoxes();
		drawBoxes();
		
		eventCheck();

		clearInactive();
		updateHud();

		delta++;
		if(gameOn){
			setTimeout(gameLoop, (gameSpeed*30));
		}
		
	}

// Gameplay

	document.onkeydown = function(e){
		//console.log(e);
		
		if(e.keyCode == 65 && gameOn){ // Left
			playerOne.velocity.x = -8;
		}
		else if(e.keyCode == 68 && gameOn){ // Right
			playerOne.velocity.x = 8;
		}
		else if(e.keyCode == 87 && gameOn){ // Up
			playerOne.velocity.y = -8;
		}
		else if(e.keyCode == 83 && gameOn){ // Down
			playerOne.velocity.y = 8;
		}
		if(e.keyCode == 32 && gameOn && weaponCharged){ // Fire
			blasterFire();
		}
		if(e.keyCode == 27){ // Pause gameloop
			if(gameOn){
				gameOn = false;
				document.getElementById("centerMessage").innerHTML = "Paused";
				document.getElementById("centerMessage").style.visibility = "visible";
			}
			else{
				gameOn = true;
				document.getElementById("centerMessage").style.visibility = "hidden";
				gameLoop();
				setTimeout(newWave, (gameSpeed*10000));
				setTimeout(spawnSphere, 18000, -120, 200);
			}
		}
		drawPlayer();
	}

	document.onkeyup = function(e){
		//console.log(e);
		if(e.keyCode == 65 && gameOn){ // Left
			playerOne.velocity.x = 0;
		}
		if(e.keyCode == 68 && gameOn){ // Right
			playerOne.velocity.x = 0;
		}
		if(e.keyCode == 87 && gameOn){ // Up
			playerOne.velocity.y = 0;
		}
		if(e.keyCode == 83 && gameOn){ // Down
			playerOne.velocity.y = 0;
		}
		drawPlayer();
	}

// Initialization

	gameLoop(); // Run game
	//newWave(); // Send first wave
	returnFire(); // Stuff to dodge!
	setTimeout(spawnSphere, 1000, -120, 200); // Set timer for first sphere sequence
	spawnStarfighter({left: 0, top: 0}, {left: 700, top: 300});
	//spawnStarfighter(800,0,100,500);


	
	</script>
</body>
</html>